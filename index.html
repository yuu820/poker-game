<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É† „Ç™„É≥„É©„Ç§„É≥„Éù„Éº„Ç´„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f3460, #16537e);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
        }
        
        .auth-form {
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            text-align: center;
            min-width: 300px;
        }
        
        .auth-form h2 {
            color: #ffd700;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #333;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
        }
        
        .btn {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }
        
        .lobby-screen {
            display: none;
        }
        
        .lobby-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .lobby-header h1 {
            color: #ffd700;
            font-size: 3em;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 10px;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #ffd700;
        }
        
        .chip-count {
            font-size: 1.5em;
            color: #ffd700;
            font-weight: bold;
        }
        
        .game-rooms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .room-card {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
        }
        
        .game-screen {
            display: none;
        }
        
        .poker-table {
            background: radial-gradient(ellipse, #0a5d2f 0%, #0a3d1f 70%, #051a0f 100%);
            border: 8px solid #8b4513;
            border-radius: 50%;
            width: 800px;
            height: 500px;
            margin: 20px auto;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5), 0 0 30px rgba(139, 69, 19, 0.3);
        }
        
        .community-cards {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
        }
        
        .card {
            width: 60px;
            height: 85px;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        
        .card.hidden {
            background: #000080;
            color: white;
        }
        
        .card .suit {
            font-size: 20px;
        }
        
        .card.red {
            color: red;
        }
        
        .card.black {
            color: black;
        }
        
        .player-seats {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .player-seat {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            min-width: 120px;
            text-align: center;
        }
        
        .player-seat.seat-0 { top: -30px; left: 50%; transform: translateX(-50%); }
        .player-seat.seat-1 { top: 20%; right: -20px; }
        .player-seat.seat-2 { top: 50%; right: -20px; transform: translateY(-50%); }
        .player-seat.seat-3 { bottom: 20%; right: -20px; }
        .player-seat.seat-4 { bottom: -30px; left: 50%; transform: translateX(-50%); }
        .player-seat.seat-5 { bottom: 20%; left: -20px; }
        .player-seat.seat-6 { top: 50%; left: -20px; transform: translateY(-50%); }
        .player-seat.seat-7 { top: 20%; left: -20px; }
        
        .player-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .player-chips {
            color: #fff;
            font-size: 0.9em;
        }
        
        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 10px 0;
        }
        
        .player-cards .card {
            width: 30px;
            height: 40px;
            font-size: 10px;
            padding: 2px;
        }
        
        .game-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .game-info {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .pot-info {
            font-size: 1.3em;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .bet-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .bet-input {
            padding: 8px;
            border: 2px solid #333;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            width: 100px;
        }
        
        .current-player {
            border-color: #ff0000 !important;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
        }
        
        .folded {
            opacity: 0.5;
        }
        
        .winner {
            border-color: #00ff00 !important;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo h1 {
            color: #ffd700;
            font-size: 2.5em;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }
        
        .message-area {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            height: 100px;
            overflow-y: auto;
            margin: 10px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ë™çË®ºÁîªÈù¢ -->
        <div id="authScreen" class="auth-screen">
            <div class="logo">
                <h1>üé∞ ROYAL POKER üé∞</h1>
            </div>
            <div class="auth-form">
                <h2 id="authTitle">„É≠„Ç∞„Ç§„É≥</h2>
                <div class="form-group">
                    <label for="userId">„É¶„Éº„Ç∂„ÉºID</label>
                    <input type="text" id="userId" required>
                </div>
                <div class="form-group">
                    <label for="password">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="password" required>
                </div>
                <button class="btn" onclick="handleAuth()">„É≠„Ç∞„Ç§„É≥</button>
                <button class="btn" onclick="toggleAuthMode()">Êñ∞Ë¶èÁôªÈå≤</button>
                <div id="authMessage" style="margin-top: 15px; color: #ff6b6b;"></div>
            </div>
        </div>

        <!-- „É≠„Éì„ÉºÁîªÈù¢ -->
        <div id="lobbyScreen" class="lobby-screen">
            <div class="lobby-header">
                <h1>üé∞ ROYAL POKER LOBBY üé∞</h1>
            </div>
            
            <div class="user-info">
                <div>
                    <span>„Éó„É¨„Ç§„É§„Éº: </span>
                    <span id="currentUser" class="chip-count"></span>
                </div>
                <div class="chip-count">
                    üí∞ <span id="userChips">10000</span> „ÉÅ„ÉÉ„Éó
                </div>
                <button class="btn" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
            
            <div class="game-rooms">
                <div class="room-card" onclick="joinRoom(1, 100)">
                    <h3>üî• „Éì„ÇÆ„Éä„Éº„É´„Éº„É†</h3>
                    <p>„Éñ„É©„Ç§„É≥„Éâ: 50/100</p>
                    <p>„Éó„É¨„Ç§„É§„Éº: <span id="room1Players">0</span>/6</p>
                </div>
                <div class="room-card" onclick="joinRoom(2, 500)">
                    <h3>‚ö° „Çπ„Çø„É≥„ÉÄ„Éº„Éâ„É´„Éº„É†</h3>
                    <p>„Éñ„É©„Ç§„É≥„Éâ: 250/500</p>
                    <p>„Éó„É¨„Ç§„É§„Éº: <span id="room2Players">0</span>/6</p>
                </div>
                <div class="room-card" onclick="joinRoom(3, 1000)">
                    <h3>üëë VIP„É´„Éº„É†</h3>
                    <p>„Éñ„É©„Ç§„É≥„Éâ: 500/1000</p>
                    <p>„Éó„É¨„Ç§„É§„Éº: <span id="room3Players">0</span>/6</p>
                </div>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div id="gameScreen" class="game-screen">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #ffd700;">üé∞ „ÉÜ„Ç≠„Çµ„Çπ„Éõ„Éº„É´„Éá„É†</h2>
                <div>
                    <span>„ÉÅ„ÉÉ„Éó: </span>
                    <span id="gameUserChips" class="chip-count">10000</span>
                    <button class="btn" onclick="leaveGame()" style="margin-left: 20px;">ÈÄÄÂÆ§</button>
                </div>
            </div>
            
            <div class="game-info">
                <div class="pot-info">
                    üí∞ „Éù„ÉÉ„Éà: <span id="potAmount">0</span> „ÉÅ„ÉÉ„Éó
                </div>
                <div id="gamePhase">„Ç≤„Éº„É†ÂæÖÊ©ü‰∏≠...</div>
            </div>
            
            <div class="poker-table">
                <div class="community-cards" id="communityCards">
                    <!-- „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
                
                <div class="player-seats" id="playerSeats">
                    <!-- „Éó„É¨„Ç§„É§„Éº„ÅÆÂ∏≠„Åå„Åì„Åì„Å´ÈÖçÁΩÆ„Åï„Çå„Çã -->
                </div>
            </div>
            
            <div class="bet-controls" id="betControls" style="display: none;">
                <button class="btn" onclick="playerAction('fold')">„Éï„Ç©„Éº„É´„Éâ</button>
                <button class="btn" onclick="playerAction('call')">„Ç≥„Éº„É´</button>
                <button class="btn" onclick="playerAction('raise')">„É¨„Ç§„Ç∫</button>
                <input type="number" id="raiseAmount" class="bet-input" placeholder="ÈáëÈ°ç" min="0">
                <button class="btn" onclick="playerAction('check')">„ÉÅ„Çß„ÉÉ„ÇØ</button>
                <button class="btn" onclick="playerAction('all-in')">„Ç™„Éº„É´„Ç§„É≥</button>
            </div>
            
            <div class="message-area" id="gameMessages">
                „Ç≤„Éº„É†ÈñãÂßã„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...
            </div>
        </div>
    </div>

    <script>
        // „Éá„Éº„Çø„Éô„Éº„Çπ‰ª£ÊõøÔºà„É°„É¢„É™ÂÜÖ„Çπ„Éà„É¨„Éº„Ç∏Ôºâ
        let users = {};
        let gameRooms = {
            1: { players: [], blinds: [50, 100], maxPlayers: 6 },
            2: { players: [], blinds: [250, 500], maxPlayers: 6 },
            3: { players: [], blinds: [500, 1000], maxPlayers: 6 }
        };
        let currentUser = null;
        let currentRoom = null;
        let gameState = null;
        let isLoginMode = true;

        // „Ç´„Éº„ÉâÈñ¢ÈÄ£
        const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        // Ë™çË®ºÈñ¢ÈÄ£
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            const title = document.getElementById('authTitle');
            const button = event.target;
            
            if (isLoginMode) {
                title.textContent = '„É≠„Ç∞„Ç§„É≥';
                button.textContent = 'Êñ∞Ë¶èÁôªÈå≤';
                button.previousElementSibling.textContent = '„É≠„Ç∞„Ç§„É≥';
            } else {
                title.textContent = 'Êñ∞Ë¶èÁôªÈå≤';
                button.textContent = '„É≠„Ç∞„Ç§„É≥';
                button.previousElementSibling.textContent = 'ÁôªÈå≤';
            }
            document.getElementById('authMessage').textContent = '';
        }

        function handleAuth() {
            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value.trim();
            const messageEl = document.getElementById('authMessage');
            
            if (!userId || !password) {
                messageEl.textContent = '„É¶„Éº„Ç∂„ÉºID„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                return;
            }
            
            if (isLoginMode) {
                // „É≠„Ç∞„Ç§„É≥
                if (users[userId] && users[userId].password === password) {
                    currentUser = userId;
                    showLobby();
                    messageEl.textContent = '';
                } else {
                    messageEl.textContent = '„É¶„Éº„Ç∂„ÉºID„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                }
            } else {
                // Êñ∞Ë¶èÁôªÈå≤
                if (users[userId]) {
                    messageEl.textContent = '„Åì„ÅÆ„É¶„Éº„Ç∂„ÉºID„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                } else {
                    users[userId] = {
                        password: password,
                        chips: 10000,
                        gamesPlayed: 0,
                        gamesWon: 0,
                        totalWinnings: 0
                    };
                    currentUser = userId;
                    showLobby();
                    messageEl.textContent = '';
                    addGameMessage(`${userId}„Åï„Çì„ÅåÊñ∞Ë¶èÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅÂàùÂõû„Éú„Éº„Éä„Çπ10000„ÉÅ„ÉÉ„Éó„Çí„Éó„É¨„Çº„É≥„ÉàÔºÅ`);
                }
            }
        }

        function logout() {
            if (currentRoom) {
                leaveGame();
            }
            currentUser = null;
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('userId').value = '';
            document.getElementById('password').value = '';
        }

        function showLobby() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'block';
            document.getElementById('gameScreen').style.display = 'none';
            
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('userChips').textContent = users[currentUser].chips;
            
            updateRoomCounts();
        }

        function updateRoomCounts() {
            for (let roomId in gameRooms) {
                document.getElementById(`room${roomId}Players`).textContent = gameRooms[roomId].players.length;
            }
        }

        // „Ç≤„Éº„É†„É´„Éº„É†Èñ¢ÈÄ£
        function joinRoom(roomId, minBuyin) {
            if (users[currentUser].chips < minBuyin) {
                alert(`„Åì„ÅÆ„É´„Éº„É†„Å´ÂèÇÂä†„Åô„Çã„Å´„ÅØÊúÄ‰Ωé${minBuyin}„ÉÅ„ÉÉ„Éó„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`);
                return;
            }
            
            const room = gameRooms[roomId];
            if (room.players.length >= room.maxPlayers) {
                alert('„Åì„ÅÆ„É´„Éº„É†„ÅØÊ∫ÄÂ∏≠„Åß„Åô„ÄÇ');
                return;
            }
            
            // „Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†
            const playerData = {
                id: currentUser,
                chips: users[currentUser].chips,
                cards: [],
                folded: false,
                currentBet: 0,
                position: room.players.length
            };
            
            room.players.push(playerData);
            currentRoom = roomId;
            
            showGameScreen();
            addGameMessage(`${currentUser}„Åï„Çì„Åå„ÉÜ„Éº„Éñ„É´„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü„ÄÇ`);
            
            // „Ç≤„Éº„É†ÈñãÂßã„ÉÅ„Çß„ÉÉ„ÇØ
            if (room.players.length >= 2 && !gameState) {
                startNewGame();
            }
        }

        function leaveGame() {
            if (!currentRoom) return;
            
            const room = gameRooms[currentRoom];
            room.players = room.players.filter(p => p.id !== currentUser);
            
            addGameMessage(`${currentUser}„Åï„Çì„Åå„ÉÜ„Éº„Éñ„É´„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åó„Åü„ÄÇ`);
            currentRoom = null;
            gameState = null;
            
            showLobby();
        }

        function showGameScreen() {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('gameUserChips').textContent = users[currentUser].chips;
            
            updateGameDisplay();
        }

        // „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ
        function createDeck() {
            const deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({ suit, rank });
                }
            }
            return shuffleDeck(deck);
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function startNewGame() {
            if (!currentRoom || gameRooms[currentRoom].players.length < 2) return;
            
            const room = gameRooms[currentRoom];
            gameState = {
                deck: createDeck(),
                communityCards: [],
                pot: 0,
                currentBet: 0,
                phase: 'preflop', // preflop, flop, turn, river, showdown
                currentPlayer: 0,
                dealer: 0,
                smallBlind: room.blinds[0],
                bigBlind: room.blinds[1],
                round: 1
            };
            
            // „Éó„É¨„Ç§„É§„Éº„Çí„É™„Çª„ÉÉ„Éà
            room.players.forEach(player => {
                player.cards = [];
                player.folded = false;
                player.currentBet = 0;
            });
            
            dealHoleCards();
            postBlinds();
            updateGameDisplay();
            addGameMessage('Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÅåÈñãÂßã„Åï„Çå„Åæ„Åó„ÅüÔºÅ');
            
            document.getElementById('potAmount').textContent = gameState.pot;
            document.getElementById('gamePhase').textContent = '„Éó„É™„Éï„É≠„ÉÉ„Éó - „Éô„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„É©„Ç¶„É≥„Éâ';
            
            if (isCurrentUserTurn()) {
                showBetControls();
            }
        }

        function dealHoleCards() {
            const room = gameRooms[currentRoom];
            
            // ÂêÑ„Éó„É¨„Ç§„É§„Éº„Å´2Êûö„ÅÆ„Ç´„Éº„Éâ„ÇíÈÖç„Çã
            for (let i = 0; i < 2; i++) {
                room.players.forEach(player => {
                    player.cards.push(gameState.deck.pop());
                });
            }
        }

        function postBlinds() {
            const room = gameRooms[currentRoom];
            const sbIndex = (gameState.dealer + 1) % room.players.length;
            const bbIndex = (gameState.dealer + 2) % room.players.length;
            
            // „Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ
            const sbPlayer = room.players[sbIndex];
            sbPlayer.currentBet = gameState.smallBlind;
            sbPlayer.chips -= gameState.smallBlind;
            gameState.pot += gameState.smallBlind;
            
            // „Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ
            const bbPlayer = room.players[bbIndex];
            bbPlayer.currentBet = gameState.bigBlind;
            bbPlayer.chips -= gameState.bigBlind;
            gameState.pot += gameState.bigBlind;
            gameState.currentBet = gameState.bigBlind;
            
            gameState.currentPlayer = (bbIndex + 1) % room.players.length;
            
            addGameMessage(`${sbPlayer.id}„Åï„Çì„Åå„Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ${gameState.smallBlind}„ÉÅ„ÉÉ„Éó`);
            addGameMessage(`${bbPlayer.id}„Åï„Çì„Åå„Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ${gameState.bigBlind}„ÉÅ„ÉÉ„Éó`);
        }

        function updateGameDisplay() {
            if (!currentRoom || !gameState) return;
            
            const room = gameRooms[currentRoom];
            const seatsContainer = document.getElementById('playerSeats');
            seatsContainer.innerHTML = '';
            
            room.players.forEach((player, index) => {
                const seat = document.createElement('div');
                seat.className = `player-seat seat-${index}`;
                if (index === gameState.currentPlayer) {
                    seat.classList.add('current-player');
                }
                if (player.folded) {
                    seat.classList.add('folded');
                }
                
                let cardsHtml = '';
                if (player.id === currentUser) {
                    // Ëá™ÂàÜ„ÅÆ„Ç´„Éº„Éâ„ÅØË°®Á§∫
                    cardsHtml = player.cards.map(card => 
                        `<div class="card ${getSuitColor(card.suit)}">
                            <div>${card.rank}</div>
                            <div class="suit">${card.suit}</div>
                        </div>`
                    ).join('');
                } else {
                    // ‰ªñ‰∫∫„ÅÆ„Ç´„Éº„Éâ„ÅØË£èÈù¢
                    cardsHtml = player.cards.map(() => 
                        '<div class="card hidden">üÇ†</div>'
                    ).join('');
                }
                
                seat.innerHTML = `
                    <div class="player-name">${player.id}</div>
                    <div class="player-chips">${player.chips} „ÉÅ„ÉÉ„Éó</div>
                    <div class="player-cards">${cardsHtml}</div>
                    <div style="font-size: 0.8em;">„Éô„ÉÉ„Éà: ${player.currentBet}</div>
                `;
                
                seatsContainer.appendChild(seat);
            });
            
            // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ„ÅÆË°®Á§∫
            const communityContainer = document.getElementById('communityCards');
            communityContainer.innerHTML = gameState.communityCards.map(card =>
                `<div class="card ${getSuitColor(card.suit)}">
                    <div>${card.rank}</div>
                    <div class="suit">${card.suit}</div>
                </div>`
            ).join('');
            
            document.getElementById('potAmount').textContent = gameState.pot;
            document.getElementById('gameUserChips').textContent = users[currentUser].chips;
        }

        function getSuitColor(suit) {
            return (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black';
        }

        function isCurrentUserTurn() {
            if (!currentRoom || !gameState) return false;
            const room = gameRooms[currentRoom];
            return room.players[gameState.currentPlayer].id === currentUser;
        }

        function showBetControls() {
            document.getElementById('betControls').style.display = 'flex';
        }

        function hideBetControls() {
            document.getElementById('betControls').style.display = 'none';
        }

        function playerAction(action) {
            if (!isCurrentUserTurn()) return;
            
            const room = gameRooms[currentRoom];
            const player = room.players.find(p => p.id === currentUser);
            let actionTaken = false;
            
            switch (action) {
                case 'fold':
                    player.folded = true;
                    addGameMessage(`${currentUser}„Åï„Çì„Åå„Éï„Ç©„Éº„É´„Éâ„Åó„Åæ„Åó„Åü„ÄÇ`);
                    actionTaken = true;
                    break;
                    
                case 'call':
                    const callAmount = gameState.currentBet - player.currentBet;
                    if (player.chips >= callAmount) {
                        player.chips -= callAmount;
                        player.currentBet += callAmount;
                        gameState.pot += callAmount;
                        addGameMessage(`${currentUser}„Åï„Çì„Åå${callAmount}„ÉÅ„ÉÉ„Éó„Åß„Ç≥„Éº„É´„Åó„Åæ„Åó„Åü„ÄÇ`);
                        actionTaken = true;
                    }
                    break;
                    
                case 'raise':
                    const raiseAmount = parseInt(document.getElementById('raiseAmount').value) || gameState.bigBlind;
                    const totalBet = gameState.currentBet + raiseAmount;
                    const required = totalBet - player.currentBet;
                    
                    if (player.chips >= required && raiseAmount > 0) {
                        player.chips -= required;
                        player.currentBet = totalBet;
                        gameState.pot += required;
                        gameState.currentBet = totalBet;
                        addGameMessage(`${currentUser}„Åï„Çì„Åå${raiseAmount}„ÉÅ„ÉÉ„Éó„É¨„Ç§„Ç∫„Åó„Åæ„Åó„Åü„ÄÇ`);
                        actionTaken = true;
                    }
                    break;
                    
                case 'check':
                    if (player.currentBet === gameState.currentBet) {
                        addGameMessage(`${currentUser}„Åï„Çì„Åå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„Åü„ÄÇ`);
                        actionTaken = true;
                    }
                    break;
                    
                case 'all-in':
                    const allInAmount = player.chips;
                    if (allInAmount > 0) {
                        gameState.pot += allInAmount;
                        player.currentBet += allInAmount;
                        if (player.currentBet > gameState.currentBet) {
                            gameState.currentBet = player.currentBet;
                        }
                        player.chips = 0;
                        addGameMessage(`${currentUser}„Åï„Çì„Åå„Ç™„Éº„É´„Ç§„É≥„Åó„Åæ„Åó„ÅüÔºÅÔºà${allInAmount}„ÉÅ„ÉÉ„ÉóÔºâ`);
                        actionTaken = true;
                    }
                    break;
            }
            
            if (actionTaken) {
                hideBetControls();
                nextPlayer();
                updateGameDisplay();
            }
        }

        function nextPlayer() {
            const room = gameRooms[currentRoom];
            let activePlayers = room.players.filter(p => !p.folded);
            
            if (activePlayers.length <= 1) {
                endHand();
                return;
            }
            
            // Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÁßªÂãï
            do {
                gameState.currentPlayer = (gameState.currentPlayer + 1) % room.players.length;
            } while (room.players[gameState.currentPlayer].folded);
            
            // „Éô„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„É©„Ç¶„É≥„Éâ„ÅÆÁµÇ‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ
            if (isBettingRoundComplete()) {
                nextPhase();
            } else if (isCurrentUserTurn()) {
                showBetControls();
            }
        }

        function isBettingRoundComplete() {
            const room = gameRooms[currentRoom];
            const activePlayers = room.players.filter(p => !p.folded);
            
            // ÂÖ®Âì°„ÅåÂêåÈ°ç„Éô„ÉÉ„Éà„Åó„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const maxBet = Math.max(...activePlayers.map(p => p.currentBet));
            return activePlayers.every(p => p.currentBet === maxBet || p.chips === 0);
        }

        function nextPhase() {
            const phases = ['preflop', 'flop', 'turn', 'river', 'showdown'];
            const currentPhaseIndex = phases.indexOf(gameState.phase);
            
            if (currentPhaseIndex < phases.length - 1) {
                gameState.phase = phases[currentPhaseIndex + 1];
                
                // „Éô„ÉÉ„ÉàÈ°ç„Çí„É™„Çª„ÉÉ„Éà
                const room = gameRooms[currentRoom];
                room.players.forEach(p => p.currentBet = 0);
                gameState.currentBet = 0;
                
                // „Éá„Ç£„Éº„É©„Éº„ÅÆÊ¨°„Åã„ÇâÈñãÂßã
                gameState.currentPlayer = (gameState.dealer + 1) % room.players.length;
                while (room.players[gameState.currentPlayer].folded) {
                    gameState.currentPlayer = (gameState.currentPlayer + 1) % room.players.length;
                }
                
                dealCommunityCards();
                updateGameDisplay();
                
                if (gameState.phase === 'showdown') {
                    showdown();
                } else if (isCurrentUserTurn()) {
                    showBetControls();
                }
            } else {
                showdown();
            }
        }

        function dealCommunityCards() {
            switch (gameState.phase) {
                case 'flop':
                    // „Éê„Éº„É≥„Ç´„Éº„Éâ1ÊûöÊç®„Å¶„Å¶„ÄÅ3ÊûöËøΩÂä†
                    gameState.deck.pop();
                    for (let i = 0; i < 3; i++) {
                        gameState.communityCards.push(gameState.deck.pop());
                    }
                    addGameMessage('„Éï„É≠„ÉÉ„Éó„ÅåÈÖç„Çâ„Çå„Åæ„Åó„Åü„ÄÇ');
                    document.getElementById('gamePhase').textContent = '„Éï„É≠„ÉÉ„Éó - „Éô„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„É©„Ç¶„É≥„Éâ';
                    break;
                    
                case 'turn':
                    // „Éê„Éº„É≥„Ç´„Éº„Éâ1ÊûöÊç®„Å¶„Å¶„ÄÅ1ÊûöËøΩÂä†
                    gameState.deck.pop();
                    gameState.communityCards.push(gameState.deck.pop());
                    addGameMessage('„Çø„Éº„É≥„ÅåÈÖç„Çâ„Çå„Åæ„Åó„Åü„ÄÇ');
                    document.getElementById('gamePhase').textContent = '„Çø„Éº„É≥ - „Éô„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„É©„Ç¶„É≥„Éâ';
                    break;
                    
                case 'river':
                    // „Éê„Éº„É≥„Ç´„Éº„Éâ1ÊûöÊç®„Å¶„Å¶„ÄÅ1ÊûöËøΩÂä†
                    gameState.deck.pop();
                    gameState.communityCards.push(gameState.deck.pop());
                    addGameMessage('„É™„Éê„Éº„ÅåÈÖç„Çâ„Çå„Åæ„Åó„Åü„ÄÇ');
                    document.getElementById('gamePhase').textContent = '„É™„Éê„Éº - „Éô„ÉÉ„ÉÜ„Ç£„É≥„Ç∞„É©„Ç¶„É≥„Éâ';
                    break;
            }
        }

        function showdown() {
            const room = gameRooms[currentRoom];
            const activePlayers = room.players.filter(p => !p.folded);
            
            if (activePlayers.length === 1) {
                // 1‰∫∫„Å†„Åë„ÅåÊÆã„Å£„ÅüÂ†¥Âêà
                const winner = activePlayers[0];
                winner.chips += gameState.pot;
                users[winner.id].chips = winner.chips;
                users[winner.id].totalWinnings += gameState.pot;
                users[winner.id].gamesWon++;
                
                addGameMessage(`${winner.id}„Åï„Çì„Åå${gameState.pot}„ÉÅ„ÉÉ„Éó„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
                highlightWinner(winner.id);
            } else {
                // Ë§áÊï∞„Éó„É¨„Ç§„É§„Éº„Åß„Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥
                const results = evaluateHands(activePlayers);
                const winners = results.filter(r => r.rank === results[0].rank);
                const winAmount = Math.floor(gameState.pot / winners.length);
                
                winners.forEach(winner => {
                    winner.player.chips += winAmount;
                    users[winner.player.id].chips = winner.player.chips;
                    users[winner.player.id].totalWinnings += winAmount;
                    users[winner.player.id].gamesWon++;
                    
                    addGameMessage(`${winner.player.id}„Åï„Çì„Åå${winner.handName}„Åß${winAmount}„ÉÅ„ÉÉ„Éó„ÇíÁç≤ÂæóÔºÅ`);
                    highlightWinner(winner.player.id);
                });
            }
            
            // „Ç≤„Éº„É†Áµ±Ë®à„ÇíÊõ¥Êñ∞
            room.players.forEach(player => {
                users[player.id].gamesPlayed++;
            });
            
            document.getElementById('gamePhase').textContent = '„Éè„É≥„ÉâÁµÇ‰∫Ü';
            
            // 5ÁßíÂæå„Å´Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÈñãÂßã
            setTimeout(() => {
                // „ÉÅ„ÉÉ„Éó„Åå0„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÈô§Â§ñ
                room.players = room.players.filter(p => p.chips > 0);
                
                if (room.players.length >= 2) {
                    gameState.dealer = (gameState.dealer + 1) % room.players.length;
                    startNewGame();
                } else {
                    addGameMessage('„Ç≤„Éº„É†„ÇíÁ∂ôÁ∂ö„Åô„Çã„Å´„ÅØ2‰∫∫‰ª•‰∏ä„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ');
                    gameState = null;
                }
            }, 5000);
        }

        function evaluateHands(players) {
            const results = players.map(player => {
                const allCards = [...player.cards, ...gameState.communityCards];
                const bestHand = getBestHand(allCards);
                return {
                    player: player,
                    hand: bestHand.cards,
                    rank: bestHand.rank,
                    handName: bestHand.name
                };
            });
            
            // ÊâãÊú≠„ÅÆÂº∑„Åï„Åß„ÇΩ„Éº„ÉàÔºàÈôçÈ†ÜÔºâ
            results.sort((a, b) => b.rank - a.rank);
            return results;
        }

        function getBestHand(cards) {
            // Á∞°ÊòìÁöÑ„Å™ÊâãÊú≠Ë©ï‰æ°ÔºàÂÆüÈöõ„ÅØ„Çà„ÇäË§áÈõëÔºâ
            const suits = {};
            const ranks = {};
            
            cards.forEach(card => {
                suits[card.suit] = (suits[card.suit] || 0) + 1;
                const rankValue = getRankValue(card.rank);
                ranks[rankValue] = (ranks[rankValue] || 0) + 1;
            });
            
            const rankCounts = Object.values(ranks).sort((a, b) => b - a);
            const isFlush = Object.values(suits).some(count => count >= 5);
            const isStraight = checkStraight(Object.keys(ranks).map(Number));
            
            // ÊâãÊú≠„ÅÆË©ï‰æ°ÔºàÁ∞°Áï•ÁâàÔºâ
            if (isFlush && isStraight) return { rank: 8, name: '„Çπ„Éà„É¨„Éº„Éà„Éï„É©„ÉÉ„Ç∑„É•', cards: cards.slice(0, 5) };
            if (rankCounts[0] === 4) return { rank: 7, name: '„Éï„Ç©„Éº„Ç´„Éº„Éâ', cards: cards.slice(0, 5) };
            if (rankCounts[0] === 3 && rankCounts[1] === 2) return { rank: 6, name: '„Éï„É´„Éè„Ç¶„Çπ', cards: cards.slice(0, 5) };
            if (isFlush) return { rank: 5, name: '„Éï„É©„ÉÉ„Ç∑„É•', cards: cards.slice(0, 5) };
            if (isStraight) return { rank: 4, name: '„Çπ„Éà„É¨„Éº„Éà', cards: cards.slice(0, 5) };
            if (rankCounts[0] === 3) return { rank: 3, name: '„Çπ„É™„Éº„Ç´„Éº„Éâ', cards: cards.slice(0, 5) };
            if (rankCounts[0] === 2 && rankCounts[1] === 2) return { rank: 2, name: '„ÉÑ„Éº„Éö„Ç¢', cards: cards.slice(0, 5) };
            if (rankCounts[0] === 2) return { rank: 1, name: '„ÉØ„É≥„Éö„Ç¢', cards: cards.slice(0, 5) };
            
            return { rank: 0, name: '„Éè„Ç§„Ç´„Éº„Éâ', cards: cards.slice(0, 5) };
        }

        function getRankValue(rank) {
            switch (rank) {
                case 'A': return 14;
                case 'K': return 13;
                case 'Q': return 12;
                case 'J': return 11;
                default: return parseInt(rank);
            }
        }

        function checkStraight(rankValues) {
            rankValues.sort((a, b) => a - b);
            let consecutive = 1;
            
            for (let i = 1; i < rankValues.length; i++) {
                if (rankValues[i] === rankValues[i-1] + 1) {
                    consecutive++;
                    if (consecutive >= 5) return true;
                } else if (rankValues[i] !== rankValues[i-1]) {
                    consecutive = 1;
                }
            }
            
            // A-2-3-4-5„ÅÆ„Çπ„Éà„É¨„Éº„Éà„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ
            if (rankValues.includes(14) && rankValues.includes(2) && rankValues.includes(3) && 
                rankValues.includes(4) && rankValues.includes(5)) {
                return true;
            }
            
            return false;
        }

        function highlightWinner(playerId) {
            const seats = document.querySelectorAll('.player-seat');
            seats.forEach(seat => {
                if (seat.querySelector('.player-name').textContent === playerId) {
                    seat.classList.add('winner');
                    setTimeout(() => seat.classList.remove('winner'), 3000);
                }
            });
        }

        function endHand() {
            showdown();
        }

        function addGameMessage(message) {
            const messagesEl = document.getElementById('gameMessages');
            const time = new Date().toLocaleTimeString();
            messagesEl.innerHTML += `<div>[${time}] ${message}</div>`;
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // „ÉÜ„Çπ„ÉàÁî®„É¶„Éº„Ç∂„Éº„ÇíËøΩÂä†
            users['testuser1'] = { password: 'test123', chips: 10000, gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 };
            users['testuser2'] = { password: 'test123', chips: 10000, gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 };
            users['dealer'] = { password: 'dealer123', chips: 50000, gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 };
        });
    </script>
</body>
</html>
