<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texas Hold'em Poker - „É™„Ç¢„É´„Çø„Ç§„É†ÂØæÊà¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f3460, #16213e);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }
        
        .logo {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 2rem;
        }
        
        .login-form {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 300px;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #ffd700;
        }
        
        input {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 1rem;
        }
        
        button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #333;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .game-screen {
            display: none;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .chips {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #333;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .game-table {
            background: linear-gradient(135deg, #0d5b2c, #1a4c30);
            border-radius: 50%;
            width: 800px;
            height: 400px;
            margin: 0 auto;
            position: relative;
            border: 8px solid #8b4513;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }
        
        .player-seat {
            position: absolute;
            width: 120px;
            height: 80px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            padding: 0.5rem;
            text-align: center;
            border: 2px solid #ffd700;
            transition: all 0.3s;
        }
        
        .player-seat.active {
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255,107,107,0.5);
        }
        
        .player-seat:nth-child(1) { top: -50px; left: 50%; transform: translateX(-50%); }
        .player-seat:nth-child(2) { top: 20px; right: -60px; }
        .player-seat:nth-child(3) { bottom: 20px; right: -60px; }
        .player-seat:nth-child(4) { bottom: -50px; left: 50%; transform: translateX(-50%); }
        .player-seat:nth-child(5) { bottom: 20px; left: -60px; }
        .player-seat:nth-child(6) { top: 20px; left: -60px; }
        
        .player-name {
            font-size: 0.8rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .player-chips {
            font-size: 0.7rem;
            color: #fff;
        }
        
        .player-cards {
            margin-top: 0.5rem;
            display: flex;
            gap: 2px;
            justify-content: center;
        }
        
        .card {
            width: 25px;
            height: 35px;
            background: #fff;
            border-radius: 3px;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
        }
        
        .community-cards {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
        }
        
        .community-card {
            width: 50px;
            height: 70px;
            background: #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .pot {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,215,0,0.2);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .controls {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .control-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .control-btn.call {
            background: linear-gradient(45deg, #4ecdc4, #26a69a);
        }
        
        .control-btn.raise {
            background: linear-gradient(45deg, #ffd700, #ffb300);
            color: #333;
        }
        
        .bet-input {
            width: 100px;
            padding: 0.5rem;
            border: none;
            border-radius: 8px;
            text-align: center;
        }
        
        .game-info {
            margin-top: 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .room-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .room-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .room-card:hover {
            transform: translateY(-5px);
        }
        
        .room-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 0.5rem;
        }
        
        .room-info {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .lobby-screen {
            display: none;
        }
        
        .lobby-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .create-room-btn {
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #4ecdc4, #26a69a);
        }
        
        .message {
            margin: 1rem 0;
            padding: 0.5rem;
            border-radius: 5px;
            text-align: center;
        }
        
        .message.success {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }
        
        .message.error {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        
        .waiting-screen {
            display: none;
            text-align: center;
            margin-top: 5rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,215,0,0.3);
            border-top: 5px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
        <div class="login-screen" id="loginScreen">
            <div class="logo">üé∞ CASINO POKER üé∞</div>
            <div class="login-form">
                <h2>„É≠„Ç∞„Ç§„É≥ / Êñ∞Ë¶èÁôªÈå≤</h2>
                <div class="input-group">
                    <label for="userId">„É¶„Éº„Ç∂„ÉºID</label>
                    <input type="text" id="userId" placeholder="„É¶„Éº„Ç∂„ÉºID„ÇíÂÖ•Âäõ">
                </div>
                <div class="input-group">
                    <label for="password">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
                <button onclick="login()">„É≠„Ç∞„Ç§„É≥ / ÁôªÈå≤</button>
                <div id="loginMessage"></div>
            </div>
        </div>

        <!-- „É≠„Éì„ÉºÁîªÈù¢ -->
        <div class="lobby-screen" id="lobbyScreen">
            <div class="header">
                <div class="user-info">
                    <div>Welcome, <span id="currentUser"></span></div>
                    <div class="chips">üí∞ <span id="userChips">10000</span> chips</div>
                </div>
                <button onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
            
            <div class="lobby-header">
                <h1>üé≤ POKER LOBBY üé≤</h1>
                <button class="create-room-btn" onclick="createRoom()">Êñ∞„Åó„ÅÑ„É´„Éº„É†„Çí‰ΩúÊàê</button>
            </div>
            
            <div class="room-list" id="roomList">
                <!-- „É´„Éº„É†‰∏ÄË¶ß„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>

        <!-- ÂæÖÊ©üÁîªÈù¢ -->
        <div class="waiting-screen" id="waitingScreen">
            <h2>„Ç≤„Éº„É†ÂæÖÊ©ü‰∏≠...</h2>
            <div class="spinner"></div>
            <p>‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô</p>
            <p>ÈÉ®Â±ãÂêç: <span id="currentRoom"></span></p>
            <p>ÂèÇÂä†ËÄÖ: <span id="playerCount">1</span>/6‰∫∫</p>
            <button onclick="leaveRoom()" class="control-btn">„É´„Éº„É†„Åã„ÇâÈÄÄÂá∫</button>
        </div>

        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div class="game-screen" id="gameScreen">
            <div class="header">
                <div class="user-info">
                    <div><span id="gameUser"></span></div>
                    <div class="chips">üí∞ <span id="gameChips">10000</span> chips</div>
                </div>
                <button onclick="leaveGame()">„Ç≤„Éº„É†ÁµÇ‰∫Ü</button>
            </div>

            <div class="game-table">
                <!-- „Éó„É¨„Ç§„É§„ÉºÂ∏≠ -->
                <div class="player-seat" id="seat1">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>
                <div class="player-seat" id="seat2">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>
                <div class="player-seat" id="seat3">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>
                <div class="player-seat" id="seat4">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>
                <div class="player-seat" id="seat5">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>
                <div class="player-seat" id="seat6">
                    <div class="player-name"></div>
                    <div class="player-chips"></div>
                    <div class="player-cards"></div>
                </div>

                <!-- „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ -->
                <div class="community-cards" id="communityCards">
                    <div class="community-card">?</div>
                    <div class="community-card">?</div>
                    <div class="community-card">?</div>
                    <div class="community-card">?</div>
                    <div class="community-card">?</div>
                </div>

                <!-- „Éù„ÉÉ„Éà -->
                <div class="pot">
                    POT: <span id="potAmount">0</span> chips
                </div>
            </div>

            <div class="controls" id="gameControls">
                <button class="control-btn" onclick="fold()">FOLD</button>
                <button class="control-btn call" onclick="call()">CALL</button>
                <button class="control-btn raise" onclick="showRaiseInput()">RAISE</button>
                <div id="raiseInput" style="display: none;">
                    <input type="number" class="bet-input" id="raiseAmount" min="1" placeholder="ÈáëÈ°ç">
                    <button class="control-btn raise" onclick="raise()">Á¢∫ÂÆö</button>
                </div>
            </div>

            <div class="game-info">
                <div id="gameStatus">„Ç≤„Éº„É†ÈñãÂßã„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...</div>
                <div id="currentBet">ÁèæÂú®„ÅÆ„Éô„ÉÉ„Éà: 0 chips</div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let ws = null;
        let currentUser = '';
        let userChips = 10000;
        let gameState = null;
        let currentRoom = '';
        
        // „Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÔºàÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„Çµ„Éº„Éê„Éº„Çµ„Ç§„Éâ„ÅßÁÆ°ÁêÜÔºâ
        let users = JSON.parse(localStorage.getItem('pokerUsers') || '{}');
        let gameHistory = JSON.parse(localStorage.getItem('gameHistory') || '[]');
        
        // WebSocket„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÔºàÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØWebSocket„Çµ„Éº„Éê„Éº„Çí‰ΩøÁî®Ôºâ
        class MockWebSocket {
            constructor() {
                this.onopen = null;
                this.onmessage = null;
                this.onclose = null;
                this.rooms = JSON.parse(localStorage.getItem('pokerRooms') || '{}');
                setTimeout(() => {
                    if (this.onopen) this.onopen();
                }, 100);
            }
            
            send(data) {
                const message = JSON.parse(data);
                setTimeout(() => {
                    this.handleMessage(message);
                }, 100);
            }
            
            handleMessage(message) {
                switch(message.type) {
                    case 'createRoom':
                        this.createRoom(message);
                        break;
                    case 'joinRoom':
                        this.joinRoom(message);
                        break;
                    case 'leaveRoom':
                        this.leaveRoom(message);
                        break;
                    case 'getRooms':
                        this.getRooms();
                        break;
                    case 'gameAction':
                        this.handleGameAction(message);
                        break;
                }
            }
            
            createRoom(message) {
                const roomId = 'room_' + Date.now();
                this.rooms[roomId] = {
                    id: roomId,
                    name: `${message.user}„ÅÆ„É´„Éº„É†`,
                    players: [message.user],
                    maxPlayers: 6,
                    gameState: 'waiting'
                };
                localStorage.setItem('pokerRooms', JSON.stringify(this.rooms));
                
                if (this.onmessage) {
                    this.onmessage({
                        data: JSON.stringify({
                            type: 'roomCreated',
                            roomId: roomId
                        })
                    });
                }
            }
            
            joinRoom(message) {
                const room = this.rooms[message.roomId];
                if (room && room.players.length < 6) {
                    room.players.push(message.user);
                    localStorage.setItem('pokerRooms', JSON.stringify(this.rooms));
                    
                    if (this.onmessage) {
                        this.onmessage({
                            data: JSON.stringify({
                                type: 'roomJoined',
                                room: room
                            })
                        });
                        
                        // 2‰∫∫‰ª•‰∏ä„Åß„Ç≤„Éº„É†ÈñãÂßã
                        if (room.players.length >= 2) {
                            setTimeout(() => {
                                this.startGame(room);
                            }, 2000);
                        }
                    }
                }
            }
            
            leaveRoom(message) {
                const room = this.rooms[message.roomId];
                if (room) {
                    room.players = room.players.filter(p => p !== message.user);
                    if (room.players.length === 0) {
                        delete this.rooms[message.roomId];
                    }
                    localStorage.setItem('pokerRooms', JSON.stringify(this.rooms));
                    
                    if (this.onmessage) {
                        this.onmessage({
                            data: JSON.stringify({
                                type: 'leftRoom'
                            })
                        });
                    }
                }
            }
            
            getRooms() {
                if (this.onmessage) {
                    this.onmessage({
                        data: JSON.stringify({
                            type: 'roomList',
                            rooms: Object.values(this.rooms)
                        })
                    });
                }
            }
            
            startGame(room) {
                const gameState = {
                    phase: 'preflop',
                    pot: 0,
                    currentBet: 20,
                    players: room.players.map((name, index) => ({
                        name: name,
                        chips: users[name]?.chips || 10000,
                        cards: this.dealCards(2),
                        bet: 0,
                        folded: false,
                        position: index
                    })),
                    communityCards: [],
                    currentPlayer: 0,
                    dealerPosition: 0
                };
                
                // „Éñ„É©„Ç§„É≥„Éâ„Éô„ÉÉ„Éà
                if (gameState.players.length >= 2) {
                    gameState.players[1].bet = 10; // „Çπ„É¢„Éº„É´„Éñ„É©„Ç§„É≥„Éâ
                    gameState.players[1].chips -= 10;
                    gameState.pot += 10;
                    
                    if (gameState.players.length > 2) {
                        gameState.players[2].bet = 20; // „Éì„ÉÉ„Ç∞„Éñ„É©„Ç§„É≥„Éâ
                        gameState.players[2].chips -= 20;
                    } else {
                        gameState.players[0].bet = 20; // „Éò„ÉÉ„Ç∫„Ç¢„ÉÉ„Éó
                        gameState.players[0].chips -= 20;
                    }
                    gameState.pot += 20;
                }
                
                if (this.onmessage) {
                    this.onmessage({
                        data: JSON.stringify({
                            type: 'gameStarted',
                            gameState: gameState
                        })
                    });
                }
            }
            
            dealCards(count) {
                const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
                const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                const cards = [];
                
                for (let i = 0; i < count; i++) {
                    const suit = suits[Math.floor(Math.random() * suits.length)];
                    const rank = ranks[Math.floor(Math.random() * ranks.length)];
                    cards.push(`${rank}${suit}`);
                }
                
                return cards;
            }
            
            handleGameAction(message) {
                // „Ç≤„Éº„É†„Ç¢„ÇØ„Ç∑„Éß„É≥„ÅÆÂá¶ÁêÜÔºàÁ∞°Áï•ÂåñÔºâ
                if (this.onmessage) {
                    this.onmessage({
                        data: JSON.stringify({
                            type: 'gameUpdated',
                            action: message.action,
                            user: message.user
                        })
                    });
                }
            }
        }

        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        function login() {
            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('loginMessage');
            
            if (!userId || !password) {
                showMessage(messageDiv, '„É¶„Éº„Ç∂„ÉºID„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            // Êñ∞Ë¶è„É¶„Éº„Ç∂„Éº„Åæ„Åü„ÅØÊó¢Â≠ò„É¶„Éº„Ç∂„Éº„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
            if (!users[userId]) {
                // Êñ∞Ë¶èÁôªÈå≤
                users[userId] = {
                    password: password,
                    chips: 10000,
                    gamesPlayed: 0,
                    wins: 0,
                    losses: 0,
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('pokerUsers', JSON.stringify(users));
                showMessage(messageDiv, 'Êñ∞Ë¶è„É¶„Éº„Ç∂„Éº„ÇíÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ10000„ÉÅ„ÉÉ„Éó„Çí„Éó„É¨„Çº„É≥„ÉàÔºÅ', 'success');
            } else if (users[userId].password !== password) {
                showMessage(messageDiv, '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô', 'error');
                return;
            }
            
            currentUser = userId;
            userChips = users[userId].chips;
            
            setTimeout(() => {
                showLobby();
            }, 1000);
        }
        
        // „É≠„Éì„ÉºÁîªÈù¢Ë°®Á§∫
        function showLobby() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'block';
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('userChips').textContent = userChips;
            
            // WebSocketÊé•Á∂ö
            ws = new MockWebSocket();
            ws.onopen = function() {
                console.log('WebSocket connected');
                getRooms();
            };
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                handleWebSocketMessage(message);
            };
            
            ws.onclose = function() {
                console.log('WebSocket disconnected');
            };
        }
        
        // WebSocket„É°„ÉÉ„Çª„Éº„Ç∏„Éè„É≥„Éâ„É™„É≥„Ç∞
        function handleWebSocketMessage(message) {
            switch(message.type) {
                case 'roomList':
                    displayRooms(message.rooms);
                    break;
                case 'roomCreated':
                    currentRoom = message.roomId;
                    joinRoom(message.roomId);
                    break;
                case 'roomJoined':
                    showWaitingScreen(message.room);
                    break;
                case 'leftRoom':
                    showLobby();
                    break;
                case 'gameStarted':
                    gameState = message.gameState;
                    showGameScreen();
                    break;
                case 'gameUpdated':
                    updateGameState(message);
                    break;
            }
        }
        
        // „É´„Éº„É†‰∏ÄË¶ßË°®Á§∫
        function displayRooms(rooms) {
            const roomList = document.getElementById('roomList');
            roomList.innerHTML = '';
            
            rooms.forEach(room => {
                const roomCard = document.createElement('div');
                roomCard.className = 'room-card';
                roomCard.onclick = () => joinRoom(room.id);
                
                roomCard.innerHTML = `
                    <div class="room-name">${room.name}</div>
                    <div class="room-info">
                        „Éó„É¨„Ç§„É§„Éº: ${room.players.length}/${room.maxPlayers}<br>
                        Áä∂ÊÖã: ${room.gameState === 'waiting' ? 'ÂæÖÊ©ü‰∏≠' : '„Ç≤„Éº„É†‰∏≠'}
                    </div>
                `;
                
                roomList.appendChild(roomCard);
            });
        }
        
        // „É´„Éº„É†‰ΩúÊàê
        function createRoom() {
            if (ws) {
                ws.send(JSON.stringify({
                    type: 'createRoom',
                    user: currentUser
                }));
            }
        }
        
        // „É´„Éº„É†ÂèÇÂä†
        function joinRoom(roomId) {
            currentRoom = roomId;
            if (ws) {
                ws.send(JSON.stringify({
                    type: 'joinRoom',
                    roomId: roomId,
                    user: currentUser
                }));
            }
        }
        
        // „É´„Éº„É†ÂèñÂæó
        function getRooms() {
            if (ws) {
                ws.send(JSON.stringify({
                    type: 'getRooms'
                }));
            }
        }
        
        // ÂæÖÊ©üÁîªÈù¢Ë°®Á§∫
        function showWaitingScreen(room) {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('waitingScreen').style.display = 'block';
            document.getElementById('currentRoom').textContent = room.name;
            document.getElementById('playerCount').textContent = room.players.length;
        }
        
        // „Ç≤„Éº„É†ÁîªÈù¢Ë°®Á§∫
        function showGameScreen() {
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('gameUser').textContent = currentUser;
            document.getElementById('gameChips').textContent = userChips;
            
            updateGameDisplay();
        }
        
        // „Ç≤„Éº„É†ÁîªÈù¢Êõ¥Êñ∞
        function updateGameDisplay() {
            if (!gameState) return;
            
            // „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±Êõ¥Êñ∞
            gameState.players.forEach((player, index) => {
                const seat = document.getElementById(`seat${index + 1}`);
                if (seat) {
                    seat.querySelector('.player-name').textContent = player.name;
                    seat.querySelector('.player-chips').textContent = `${player.chips} chips`;
                    
                    // „Ç´„Éº„ÉâË°®Á§∫
                    const cardsDiv = seat.querySelector('.player-cards');
                    cardsDiv.innerHTML = '';
                    
                    if (player.name === currentUser) {
                        // Ëá™ÂàÜ„ÅÆ„Ç´„Éº„Éâ„ÅØË°®Á§∫
                        player.cards.forEach(card => {
                            const cardDiv = document.createElement('div');
                            cardDiv.className = 'card';
                            cardDiv.textContent = card;
                            cardsDiv.appendChild(cardDiv);
                        });
                    } else {
                        // ‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Ç´„Éº„Éâ„ÅØ‰ºè„Åõ„Çã
                        for (let i = 0; i < 2; i++) {
                            const cardDiv = document.createElement('div');
                            cardDiv.className = 'card';
                            cardDiv.textContent = 'üÇ†';
                            cardsDiv.appendChild(cardDiv);
                        }
                    }
                    
                    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éó„É¨„Ç§„É§„Éº„Çí„Éè„Ç§„É©„Ç§„Éà
                    if (index === gameState.currentPlayer) {
                        seat.classList.add('active');
                    } else {
                        seat.classList.remove('active');
                    }
                }
            });
            
            // „Éù„ÉÉ„ÉàÊõ¥Êñ∞
            document.getElementById('potAmount').textContent = gameState.pot;
            
            // ÁèæÂú®„ÅÆ„Éô„ÉÉ„ÉàÈ°çÊõ¥Êñ∞
            document.getElementById('currentBet').textContent = `ÁèæÂú®„ÅÆ„Éô„ÉÉ„Éà: ${gameState.currentBet} chips`;
            
            // „Ç≤„Éº„É†Áä∂ÊÖãÊõ¥Êñ∞
            const statusMap = {
                'preflop': '„Éó„É™„Éï„É≠„ÉÉ„Éó',
                'flop': '„Éï„É≠„ÉÉ„Éó',
                'turn': '„Çø„Éº„É≥',
                'river': '„É™„Éê„Éº',
                'showdown': '„Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥'
            };
            document.getElementById('gameStatus').textContent = 
                `${statusMap[gameState.phase] || gameState.phase} - ${gameState.players[gameState.currentPlayer]?.name}„ÅÆ„Çø„Éº„É≥`;
            
            // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„ÉâÊõ¥Êñ∞
            const communityCardsDiv = document.getElementById('communityCards');
            communityCardsDiv.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'community-card';
                
                if (i < gameState.communityCards.length) {
                    cardDiv.textContent = gameState.communityCards[i];
                } else {
                    cardDiv.textContent = '?';
                    cardDiv.style.background = '#333';
                    cardDiv.style.color = '#666';
                }
                
                communityCardsDiv.appendChild(cardDiv);
            }
            
            // „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥„ÅÆË°®Á§∫Âà∂Âæ°
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const controls = document.getElementById('gameControls');
            
            if (currentPlayer && currentPlayer.name === currentUser) {
                controls.style.display = 'flex';
            } else {
                controls.style.display = 'none';
            }
        }
        
        // „Ç≤„Éº„É†„Ç¢„ÇØ„Ç∑„Éß„É≥ - „Éï„Ç©„Éº„É´„Éâ
        function fold() {
            if (ws && gameState) {
                ws.send(JSON.stringify({
                    type: 'gameAction',
                    action: 'fold',
                    user: currentUser,
                    roomId: currentRoom
                }));
                
                // „É≠„Éº„Ç´„É´„Åß„Ç≤„Éº„É†Áä∂ÊÖã„ÇíÊõ¥Êñ∞ÔºàÁ∞°Áï•ÂåñÔºâ
                const playerIndex = gameState.players.findIndex(p => p.name === currentUser);
                if (playerIndex !== -1) {
                    gameState.players[playerIndex].folded = true;
                    nextPlayer();
                    updateGameDisplay();
                }
            }
        }
        
        // „Ç≤„Éº„É†„Ç¢„ÇØ„Ç∑„Éß„É≥ - „Ç≥„Éº„É´
        function call() {
            if (ws && gameState) {
                const playerIndex = gameState.players.findIndex(p => p.name === currentUser);
                if (playerIndex !== -1) {
                    const player = gameState.players[playerIndex];
                    const callAmount = gameState.currentBet - player.bet;
                    
                    if (player.chips >= callAmount) {
                        ws.send(JSON.stringify({
                            type: 'gameAction',
                            action: 'call',
                            amount: callAmount,
                            user: currentUser,
                            roomId: currentRoom
                        }));
                        
                        // „É≠„Éº„Ç´„É´„Åß„Ç≤„Éº„É†Áä∂ÊÖã„ÇíÊõ¥Êñ∞
                        player.bet += callAmount;
                        player.chips -= callAmount;
                        gameState.pot += callAmount;
                        
                        nextPlayer();
                        updateGameDisplay();
                        updateUserChips(player.chips);
                    }
                }
            }
        }
        
        // „É¨„Ç§„Ç∫ÂÖ•ÂäõË°®Á§∫
        function showRaiseInput() {
            document.getElementById('raiseInput').style.display = 'flex';
            document.getElementById('raiseAmount').focus();
        }
        
        // „Ç≤„Éº„É†„Ç¢„ÇØ„Ç∑„Éß„É≥ - „É¨„Ç§„Ç∫
        function raise() {
            const raiseAmount = parseInt(document.getElementById('raiseAmount').value);
            if (!raiseAmount || raiseAmount < gameState.currentBet) {
                alert('„É¨„Ç§„Ç∫È°ç„Åå‰∏çÊ≠£„Åß„Åô');
                return;
            }
            
            if (ws && gameState) {
                const playerIndex = gameState.players.findIndex(p => p.name === currentUser);
                if (playerIndex !== -1) {
                    const player = gameState.players[playerIndex];
                    const totalBet = raiseAmount;
                    const additionalBet = totalBet - player.bet;
                    
                    if (player.chips >= additionalBet) {
                        ws.send(JSON.stringify({
                            type: 'gameAction',
                            action: 'raise',
                            amount: totalBet,
                            user: currentUser,
                            roomId: currentRoom
                        }));
                        
                        // „É≠„Éº„Ç´„É´„Åß„Ç≤„Éº„É†Áä∂ÊÖã„ÇíÊõ¥Êñ∞
                        player.bet = totalBet;
                        player.chips -= additionalBet;
                        gameState.pot += additionalBet;
                        gameState.currentBet = totalBet;
                        
                        document.getElementById('raiseInput').style.display = 'none';
                        document.getElementById('raiseAmount').value = '';
                        
                        nextPlayer();
                        updateGameDisplay();
                        updateUserChips(player.chips);
                    }
                }
            }
        }
        
        // Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÁßªË°å
        function nextPlayer() {
            if (!gameState) return;
            
            let nextIndex = (gameState.currentPlayer + 1) % gameState.players.length;
            let attempts = 0;
            
            // „Éï„Ç©„Éº„É´„Éâ„Åó„Å¶„ÅÑ„Å™„ÅÑ„Éó„É¨„Ç§„É§„Éº„ÇíÊé¢„Åô
            while (gameState.players[nextIndex].folded && attempts < gameState.players.length) {
                nextIndex = (nextIndex + 1) % gameState.players.length;
                attempts++;
            }
            
            gameState.currentPlayer = nextIndex;
            
            // ÂÖ®„Éó„É¨„Ç§„É§„Éº„Åå„Éô„ÉÉ„Éà„ÇíÂÆå‰∫Ü„Åó„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const activePlayers = gameState.players.filter(p => !p.folded);
            const allBetsEqual = activePlayers.every(p => p.bet === gameState.currentBet);
            
            if (allBetsEqual && activePlayers.length > 1) {
                nextPhase();
            }
        }
        
        // Ê¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Å´ÁßªË°å
        function nextPhase() {
            if (!gameState) return;
            
            // ÂÖ®„Éó„É¨„Ç§„É§„Éº„ÅÆ„Éô„ÉÉ„Éà„Çí„É™„Çª„ÉÉ„Éà
            gameState.players.forEach(player => {
                player.bet = 0;
            });
            gameState.currentBet = 0;
            
            switch (gameState.phase) {
                case 'preflop':
                    gameState.phase = 'flop';
                    gameState.communityCards = dealCommunityCards(3);
                    break;
                case 'flop':
                    gameState.phase = 'turn';
                    gameState.communityCards.push(...dealCommunityCards(1));
                    break;
                case 'turn':
                    gameState.phase = 'river';
                    gameState.communityCards.push(...dealCommunityCards(1));
                    break;
                case 'river':
                    gameState.phase = 'showdown';
                    showdown();
                    return;
            }
            
            gameState.currentPlayer = gameState.dealerPosition;
            updateGameDisplay();
        }
        
        // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Ç´„Éº„Éâ„ÇíÈÖç„Çã
        function dealCommunityCards(count) {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const cards = [];
            
            for (let i = 0; i < count; i++) {
                const suit = suits[Math.floor(Math.random() * suits.length)];
                const rank = ranks[Math.floor(Math.random() * ranks.length)];
                cards.push(`${rank}${suit}`);
            }
            
            return cards;
        }
        
        // „Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥ÔºàÁ∞°Áï•ÂåñÔºâ
        function showdown() {
            const activePlayers = gameState.players.filter(p => !p.folded);
            
            if (activePlayers.length === 1) {
                // ‰∏Ä‰∫∫„Å†„Åë„ÅåÊÆã„Å£„ÅüÂ†¥Âêà
                const winner = activePlayers[0];
                winner.chips += gameState.pot;
                
                showMessage(document.getElementById('gameStatus'), 
                    `${winner.name}„ÅåÂãùÂà©ÔºÅ ${gameState.pot} chips„ÇíÁç≤ÂæóÔºÅ`, 'success');
                
                updateUserChips(winner.chips);
                recordGameResult(winner.name, gameState.pot);
                
                setTimeout(() => {
                    endGame();
                }, 3000);
            } else {
                // Ë§áÊï∞„Éó„É¨„Ç§„É§„Éº„ÅåÊÆã„Å£„ÅüÂ†¥ÂêàÔºàÁ∞°Áï•Âåñ: „É©„É≥„ÉÄ„É†ÂãùËÄÖÔºâ
                const winner = activePlayers[Math.floor(Math.random() * activePlayers.length)];
                winner.chips += gameState.pot;
                
                showMessage(document.getElementById('gameStatus'), 
                    `„Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥ÔºÅ ${winner.name}„ÅåÂãùÂà©ÔºÅ ${gameState.pot} chips„ÇíÁç≤ÂæóÔºÅ`, 'success');
                
                updateUserChips(winner.chips);
                recordGameResult(winner.name, gameState.pot);
                
                setTimeout(() => {
                    endGame();
                }, 5000);
            }
        }
        
        // „É¶„Éº„Ç∂„Éº„ÉÅ„ÉÉ„ÉóÊõ¥Êñ∞
        function updateUserChips(chips) {
            if (users[currentUser]) {
                users[currentUser].chips = chips;
                localStorage.setItem('pokerUsers', JSON.stringify(users));
                userChips = chips;
                document.getElementById('gameChips').textContent = chips;
            }
        }
        
        // „Ç≤„Éº„É†ÁµêÊûúË®òÈå≤
        function recordGameResult(winner, potAmount) {
            const gameResult = {
                timestamp: new Date().toISOString(),
                roomId: currentRoom,
                players: gameState.players.map(p => p.name),
                winner: winner,
                potAmount: potAmount,
                finalChips: {}
            };
            
            gameState.players.forEach(player => {
                gameResult.finalChips[player.name] = player.chips;
                
                // „Éó„É¨„Ç§„É§„ÉºÁµ±Ë®àÊõ¥Êñ∞
                if (users[player.name]) {
                    users[player.name].gamesPlayed++;
                    if (player.name === winner) {
                        users[player.name].wins++;
                    } else {
                        users[player.name].losses++;
                    }
                }
            });
            
            gameHistory.push(gameResult);
            localStorage.setItem('gameHistory', JSON.stringify(gameHistory));
            localStorage.setItem('pokerUsers', JSON.stringify(users));
        }
        
        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        function endGame() {
            gameState = null;
            showLobby();
            getRooms();
        }
        
        // „É´„Éº„É†„Åã„ÇâÈÄÄÂá∫
        function leaveRoom() {
            if (ws && currentRoom) {
                ws.send(JSON.stringify({
                    type: 'leaveRoom',
                    roomId: currentRoom,
                    user: currentUser
                }));
            }
        }
        
        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        function leaveGame() {
            if (confirm('Êú¨ÂΩì„Å´„Ç≤„Éº„É†„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü')) {
                leaveRoom();
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function logout() {
            if (ws) {
                ws.close();
            }
            currentUser = '';
            userChips = 10000;
            gameState = null;
            currentRoom = '';
            
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('userId').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginMessage').innerHTML = '';
        }
        
        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫„Éò„É´„Éë„ÉºÈñ¢Êï∞
        function showMessage(element, message, type) {
            element.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 3000);
        }
        
        // „Ç≤„Éº„É†Áä∂ÊÖãÊõ¥Êñ∞
        function updateGameState(message) {
            const statusDiv = document.getElementById('gameStatus');
            showMessage(statusDiv, `${message.user}„Åå${message.action}„Åó„Åæ„Åó„Åü`, 'success');
        }
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // „Ç®„É≥„Çø„Éº„Ç≠„Éº„Åß„É≠„Ç∞„Ç§„É≥
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // „É¨„Ç§„Ç∫ÈáëÈ°çÂÖ•Âäõ„Åß„Ç®„É≥„Çø„Éº„Ç≠„Éº
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('raiseInput').style.display !== 'none') {
                    raise();
                }
            });
        });
    </script>
</body>
</html>
